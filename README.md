# Hyperliquid TSLA 套利监控系统

监控 Hyperliquid 上 `xyz:TSLA` 和 `flx:TSLA` 之间的价差，识别套利机会。

## 功能特性

- ✅ 实时获取两个市场的 L2 订单簿数据
- ✅ 计算买卖价差和中间价
- ✅ 自动识别套利机会（基于可配置阈值）
- ✅ 显示订单簿深度
- ✅ 记录历史价差数据到 CSV
- ✅ 彩色终端输出

## 快速开始

### 安装依赖

```bash
pip install -r requirements.txt
```

### 运行监控

**测试模式（仅获取一次数据）：**
```bash
python3 spread_monitor.py --test-mode
```

**持续监控模式：**
```bash
python3 spread_monitor.py
```

按 `Ctrl+C` 停止监控。

## 配置说明

编辑 `config.py` 来调整监控参数：

```python
# 监控的资产对
ASSET_PAIR_1 = "xyz:TSLA"  # xyz 平台的 TSLA
ASSET_PAIR_2 = "flx:TSLA"  # flx (Felix) 平台的 TSLA

# 监控参数
REFRESH_INTERVAL = 2  # 秒，价格刷新间隔
SPREAD_THRESHOLD = 0.1  # 百分比，触发套利提醒的最小价差

# 手续费配置
MAKER_FEE = 0.0002  # 0.02% maker fee
TAKER_FEE = 0.0005  # 0.05% taker fee

# 交易参数（可选）
DEFAULT_POSITION_SIZE = 100  # USDC
```

## 输出说明

监控程序会显示：

1. **市场数据**：每个市场的买一价、卖一价、中间价
2. **价差分析**：绝对价差和百分比价差
3. **套利机会**：当价差超过阈值时，显示预估利润
4. **订单簿深度**：显示前 5 档买卖单（测试模式）

示例输出：
```
================================================================================
                        TSLA 套利监控 - 2025-11-28 20:03:21                         
================================================================================

【xyz:TSLA】
  买一: 428.5600
  卖一: 428.5700
  中间价: 428.5650

【flx:TSLA】
  买一: 428.5500
  卖一: 428.5600
  中间价: 428.5550

--------------------------------------------------------------------------------

【价差分析】
  绝对价差: 0.010000
  百分比价差: 0.0023%

  暂无套利机会
```

## 数据日志

所有历史价差数据会记录到 `spread_history.csv`，包含：
- 时间戳
- 两个市场的买一、卖一、中间价
- 价差（绝对值和百分比）
- 是否存在套利机会

## 文件结构

```
.
├── config.py              # 配置文件
├── spread_monitor.py      # 主监控脚本
├── utils.py               # 辅助函数
├── requirements.txt       # Python 依赖
├── spread_history.csv     # 历史数据日志（运行后生成）
└── README.md              # 本文件
```

## 重要提示

⚠️ **当前版本仅用于监控**：此版本不包含自动交易功能。如果发现持续的套利机会，可以在后续版本中添加交易执行模块。

⚠️ **风险提示**：
- 合成股票永续合约可能具有不同的资金费率
- 两个市场之间可能存在流动性差异
- 价差收敛无法保证
- 请自行评估风险后再考虑实际交易

## 技术说明

### HIP-3 市场

`xyz:TSLA` 和 `flx:TSLA` 都是 HIP-3（Hyperliquid Improvement Proposal 3）部署的永续合约市场：
- `xyz:TSLA`：由 trade.xyz (Hyperunit) 部署
- `flx:TSLA`：由 Felix Protocol 部署

### API 使用

由于 Hyperliquid Python SDK 的 `l2_snapshot()` 方法不支持 HIP-3 资产名称，本项目直接使用 SDK 的底层 `post()` 方法：

```python
orderbook = info.post("/info", {"type": "l2Book", "coin": "xyz:TSLA"})
```

## 下一步计划

如果监控结果显示存在稳定的套利机会，可以考虑：

1. **长期数据收集**：运行监控数小时/天，收集更多历史数据
2. **统计分析**：分析套利机会的频率、持续时间和利润空间
3. **交易执行**（需额外开发）：
   - 实现自动下单功能
   - 添加风险管理（止损、仓位控制）
   - 测试对冲策略

## 许可

本项目仅供学习和研究使用。
